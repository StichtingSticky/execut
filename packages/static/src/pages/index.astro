---
import { getCollection, getEntry } from 'astro:content'

import Layout from '~/layouts/section.astro'

import About from '~/components/sections/about.astro'
import Button from '~/components/button.astro'
import Header from '~/components/header.astro'
import Hosts from '~/components/sections/hosts.astro'
import Partners from '~/components/sections/partners.astro'
import Programme from '~/components/programme.astro'
import Section from '~/components/section.astro'
import Speakers from '~/components/sections/speakers.astro'
import Venue from '~/components/sections/venue.astro'

// Get the latest edition
const [edition] = await getCollection('editions')
  .then((entries) => entries.slice(-1))

const { id, data } = edition

const {
  date,
  hosts,
  partners,
  programme,
  speakers,
  talks,
  venue,
  workshops,
  committee,
} = data

// Get the name and location of the venue
const { name, location } = venue && await getEntry(venue)
  .then(({ data }) => data)

const summary = [
  ['speakers', (programme && speakers?.length) ?? 'TBA'],
  ['workshops', (programme && workshops?.length) ?? 'TBA'],
  ['location', location ?? 'TBA'],
  ['venue', name ?? 'TBA'],
]
---

<Layout>
  <Header>
    <h1 class="my-6 font-mono text-5xl font-bold text-red sm:mt-48 sm:text-6xl sm:leading-snug">
      A conference for and by IT students.
    </h1>

    <h2  class="my-2 text-2xl leading-snug text-red/80 sm:text-3xl sm:leading-normal">
      For those willing to look further than their own classroom. We want to
      work together, inspire each other, and commit ourselves to a better
      tomorrow. Besides a range of interesting talks exec(ut) provides great
      networking opportunities to those attending.
    </h2>

    <Button
      as="a"
      class="mt-4 p-4 text-xl leading-10"
      href={`https://tickets.execut.nl/${id}`}>
      Get your ticket!
    </Button>
  </Header>

  <Section>
    <figure class="my-4 grid grid-cols-2 grid-rows-2 gap-4 sm:my-8 sm:gap-6">
      {summary.map(([title, figure]) => (
        <span class="sm:text-center">
          <small class="font-mono text-sm leading-none text-light-red">{title}</small>
          <p class="mt-2 text-xl font-bold text-brown">{figure}</p>
        </span>
      ))}
  </figure>
  </Section>

  <Section id="programme">
    <h1 class="font-mono text-3xl font-bold text-red sm:text-4xl">Programme</h1>

    {programme ? (
      <>
        <p class="mt-4 sm:mt-8">
          On {new Intl.DateTimeFormat('en-GB', {
            day: 'numeric',
            month: 'long',
            year: 'numeric',
          }).format(date)}{' '}
          the {name} will host {talks ? talks.length : 'a number of'}
          consecutive speakers, each of whom will give a talk on a particular
          aspect of software and technology.
        </p>
        <p class="mt-4 sm:mt-8">
          Aside from these talks we will also host
          {workshops ? workshops.length : 'a number of'} workshops throughout
          the day! You can sign up for these workshops using our
          <a
            class="text-green underline transition-colors hover:text-green/80"
            href={`https://tickets.execut.nl/${id}/`}>
            ticket store
          </a>.
        </p>

        <Programme {programme} />

        <p class="mt-4 sm:mt-8">
          Short breaks (5 minutes) are provided between talks.
        </p>
      </>
    ) : (
      <p class="mt-4 sm:mt-8">
        The programme for this edition has not yet been announced. Please
        check back later!
      </p>
    )}
  </Section>

  <Speakers programme={programme} speakers={speakers} />

  {hosts && <Hosts hosts={hosts} />}

  {venue && <Venue venue={venue} />}

  {partners && <Partners partners={partners} />}

  <About committee={committee} />
</Layout>
